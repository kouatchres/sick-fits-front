{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.ae2773316254d6ae53a4.hot-update.js","sources":["webpack:///./components/TakeMyMoney.js"],"sourcesContent":["import React , {Component} from 'react';\r\nimport StripeCheckout from 'react-stripe-checkout';\r\nimport {Mutation }  from 'react-apollo';\r\nimport Router from 'next/router';\r\nimport NProgress from 'nprogress';\r\nimport PropTypes from 'prop-types';\r\nimport gql from 'graphql-tag';\r\nimport calcTotalPrice from '../lib/calcTotalPrice';\r\nimport Error from './ErrorMessage';\r\nimport User ,{CURRENT_USER_QUERY} from './User';\r\n\r\n\r\nconst CREATE_ORDER_MUTATION=gql`\r\nmutation CREATE_ORDER_MUTATION($token: String!){\r\n    createOrders(token: $token){\r\nid\r\ncharge\r\ntotal\r\nitems{\r\n    id \r\n    title\r\n}\r\n    }\r\n\r\n}\r\n`;\r\n\r\nfunction totalItems(cart){\r\n return   cart.reduce((tally, cartItem)=> tally + cartItem.quantity, 0);\r\n}\r\n\r\nclass TakeMyMoney extends Component{\r\n    onTokenReturn =  async  (res, createOrders) =>{\r\n        console.log('on Token called');\r\n         console.log(res.id );\r\n        //   manually call the mutation once we have the stripe token..\r\n      const orders= await  createOrders({\r\n            variables:{\r\n                token: res.id\r\n            }\r\n        }).catch(err=> {alert(err.message);});\r\n        console.log(orders);\r\n     };      \r\n    render() { \r\n    return (\r\n         <User>\r\n             {({data : {me}})=>(\r\n                 <Mutation mutation={CREATE_ORDER_MUTATION}\r\n                 refetchQueries={[{query:CURRENT_USER_QUERY }]}  >\r\n                      {(createOrders)=>(\r\n\r\n                 <StripeCheckout\r\n                 amount={calcTotalPrice(me.cart)*100}\r\n                 name =\"Sick Fits\"\r\n                 description={`Order of ${totalItems(me.cart)} items`}\r\n                 image={me.cart.length && me.cart[0].item && me.cart[0].item.image}\r\n                 stripeKey=\"pk_test_f3nffSiYTH4diibBpntXc5us00BmYPsqxc\"\r\n                 currency=\"USD\"\r\n                 email={me.email}\r\n                 token={res => this.onTokenReturn(res, createOrders)}\r\n                 >{this.props.children}\r\n                 </StripeCheckout>\r\n                      )} \r\n                 </Mutation>\r\n             )}\r\n         </User>\r\n    );\r\n}\r\n\r\n}\r\nexport default TakeMyMoney;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAcA;AACA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAKA;AACA;AADA;AADA;AAIA;AAAA;AACA;AATA;AAIA;AAKA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;AAUA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAHA;AAqBA;;;;AApCA;AACA;AAsCA;;;;A","sourceRoot":""}